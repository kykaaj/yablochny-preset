<div class="yablochny-settings">
  <div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
      <div class="yablochny-header">
        <div class="yablochny-title">
          <span>üçé</span>
          <span id="yp-title-text">Yablochny Preset</span>
        </div>
      </div>
      <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content">
      <div class="yablochny-info-links">
        <a href="https://kykaaj.github.io/yablochny/" target="_blank" class="yablochny-info-link">
          <i class="fa-solid fa-earth-americas"></i>
          <span id="yp-site-label">–°–∞–π—Ç –ø—Ä–æ–µ–∫—Ç–∞</span>
        </a>
        <a href="https://github.com/kykaaj/yablochny-preset/blob/main/README.md" target="_blank"
          class="yablochny-info-link">
          <i class="fa-solid fa-book"></i>
          <span id="yp-guide-label">–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (Guide)</span>
        </a>
      </div>

      <div class="yablochny-desc" id="yp-desc-text">
        Managed chat-completion preset. The extension creates/updates a normal preset in the list and keeps your toggle
        state and custom prompts.
      </div>

      <div class="yablochny-row" style="margin-top: 10px;">
        <div class="yablochny-field">
          <div class="yablochny-label">Mode:</div>
          <div id="yp-model-buttons" class="yablochny-model-buttons">
            <!-- Buttons are rendered dynamically in index.js -->
          </div>
        </div>
      </div>

      <div class="yablochny-controls">
        <button id="yp-sync" class="menu_button primary">
          <i class="fa-solid fa-rotate"></i>
          <span id="yp-sync-label">Sync preset</span>
        </button>

        <div class="yablochny-inline">
          <input type="checkbox" id="yp-auto-sync">
          <label for="yp-auto-sync" id="yp-auto-label">Sync on SillyTavern start</label>
        </div>
      </div>

      <div class="yablochny-row">
        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-lang-label">Language prompt</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-language" class="yablochny-select" style="flex: 1;">
              <option value="custom">Custom / don't touch</option>
              <option value="auto">Auto (match ST language)</option>
              <option value="ru">Russian</option>
              <option value="en">English</option>
              <option value="uk">Ukrainian</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="language"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>

        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-length-label">Length</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-length" class="yablochny-select" style="flex: 1;">
              <option value="custom">Custom / don't touch</option>
              <option value="200-400">200‚Äì400 words</option>
              <option value="400-600">400‚Äì600 words (default)</option>
              <option value="600-800">600‚Äì800 words</option>
              <option value="adaptive">Adaptive</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="length"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>

        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-pov-label">POV</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-pov" class="yablochny-select" style="flex: 1;">
              <option value="1st">1st person</option>
              <option value="2nd">2nd person</option>
              <option value="3rd">3rd person (default)</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="pov"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>

        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-tense-label">Tense</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-tense" class="yablochny-select" style="flex: 1;">
              <option value="Present">Present (default)</option>
              <option value="Past">Past</option>
              <option value="Future">Future</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="tense"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>



        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-prose-label">Prose style</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-prose" class="yablochny-select" style="flex: 1;">
              <option value="custom">Custom / don't touch</option>
              <option value="ao3">AO3 (default)</option>
              <option value="anne_rice">Anne Rice</option>
              <option value="donna_tartt">Donna Tartt</option>
              <option value="pratchett">Terry Pratchett</option>
              <option value="salinger">J.D. Salinger</option>
              <option value="le_guin">Ursula K. Le Guin</option>
              <option value="backman">Fredrik Backman</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="prose"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>

        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-speech-label">Speech style</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-speech" class="yablochny-select" style="flex: 1;">
              <option value="none">Custom / don't touch</option>
              <option value="salinger">cigarette confessions (Salinger)</option>
              <option value="pratchett">warm cynicism (Pratchett)</option>
              <option value="le_guin">earthsea wisdom (Le Guin)</option>
              <option value="wilde">velvet daggers (Wilde)</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="speech"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>

        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-image-mode-label">Image Style</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-image-mode" class="yablochny-select" style="flex: 1;">
              <option value="silly">Silly Images (Standard)</option>
              <option value="grok">Grok (Nai Tavern)</option>
              <option value="pollinations">Pollinations</option>
              <option value="custom">Custom (Manually Edited)</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="image"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>

        <div class="yablochny-field">
          <div class="yablochny-label" id="yp-theme-label">HTML theme</div>
          <div style="display: flex; gap: 4px; align-items: center;">
            <select id="yp-theme" class="yablochny-select" style="flex: 1;">
              <option value="custom">Custom / don't touch</option>
              <option value="dark">Dark (default)</option>
              <option value="light">Light</option>
            </select>
            <button class="yp-edit-btn menu_button secondary" data-variant-type="theme"
              style="display: none; padding: 4px 8px;">
              <i class="fa-solid fa-pen"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="yablochny-meta">
        <div id="yp-preset-name-row">
          <strong id="yp-preset-label">Preset:</strong> <span id="yp-preset-name">‚Äî</span>
        </div>
        <div id="yp-last-sync-row">
          <strong id="yp-last-sync-label">Last sync:</strong> <span id="yp-last-sync">‚Äî</span>
        </div>
        <div class="yablochny-inline">
          <input type="checkbox" id="yp-dev-mode">
          <label for="yp-dev-mode" id="yp-dev-label">Developer mode (log sync to console)</label>
        </div>
      </div>

      <hr>

      <!-- Things (collapsible) -->
      <div class="inline-drawer yablochny-subdrawer">
        <div class="inline-drawer-toggle inline-drawer-header">
          <div class="yablochny-subtitle" id="yp-things-title">‚úé Things & extras</div>
          <div class="inline-drawer-icon fa-solid fa-circle-chevron-down"></div>
        </div>
        <div class="inline-drawer-content">
          <div class="yablochny-things" id="yp-things">
            <div class="yablochny-things-note" id="yp-things-note">
              –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ ¬´—à—Ç—É–∫–∏¬ª –¥–ª—è —Ç–æ–≥–ª–∞ ‚ó¶Ô∏é ‚úé things (sample). –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Å–º–µ—à–∏–≤–∞—Ç—å, –¥—Ä—É–≥–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ
              –æ–¥–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç—É.
            </div>

            <div class="yablochny-things-group">
              <div class="yablochny-things-group-title" id="yp-things-group-mix">‚óá –ú–æ–∂–Ω–æ —Å–º–µ—à–∏–≤–∞—Ç—å</div>
              <div id="yp-things-mix" class="yablochny-things-list"></div>
            </div>

            <div class="yablochny-things-group">
              <div class="yablochny-things-group-title" id="yp-things-group-hidden">üëÅ –°–∫—Ä—ã—Ç—ã–µ –±–ª–æ–∫–∏</div>
              <div id="yp-things-hidden" class="yablochny-things-list"></div>
            </div>

            <div class="yablochny-things-group">
              <div class="yablochny-things-group-title" id="yp-things-group-cyoa">‚úß CYOA (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω)</div>
              <div id="yp-things-cyoa" class="yablochny-things-list"></div>
            </div>

            <div class="yablochny-things-group">
              <div class="yablochny-things-group-title" id="yp-things-group-fancy">‚úß Fancy UI (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω)</div>
              <div id="yp-things-fancy" class="yablochny-things-list"></div>
            </div>

            <div class="yablochny-things-group">
              <div class="yablochny-things-group-title" id="yp-things-group-comments">‚úß –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω)</div>
              <div id="yp-things-comments" class="yablochny-things-list"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Regex packs, merged here (collapsible) -->
      <div class="inline-drawer yablochny-subdrawer">
        <div class="inline-drawer-toggle inline-drawer-header">
          <div class="yablochny-subtitle" id="yp-regex-title">Regex packs for Yablochny</div>
          <div class="inline-drawer-icon fa-solid fa-circle-chevron-down"></div>
        </div>
        <div class="inline-drawer-content">
          <div class="regex-manager-section">
            <div class="yablochny-controls">
              <button id="yp-regex-toggle" class="menu_button secondary">
                <i class="fa-solid fa-power-off"></i>
                <span id="yp-regex-toggle-label">Regex ON</span>
              </button>
              <button id="yp-regex-debug" class="menu_button secondary">
                <i class="fa-solid fa-bug"></i>
                <span id="yp-regex-debug-label">Debug</span>
              </button>
            </div>

            <div class="regex-manager-desc">
              <span id="yp-regex-desc">
                Packs of regex helpers for formatting Yablochny preset output. Enable only what you use.
              </span>
            </div>

            <div id="yp-regex-list"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Prompt Editor Modal -->
<div id="yp-prompt-editor-modal"
  style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
  <div
    style="background: var(--SmartThemeBodyColor); border: 1px solid var(--SmartThemeBorderColor); border-radius: 8px; padding: 20px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
    <h3 id="yp-editor-title" style="margin-top: 0;">Edit Prompt Variant</h3>
    <div id="yp-editor-variant-row" style="margin-bottom: 10px;">
      <label for="yp-editor-variant-select" style="display: block; margin-bottom: 5px;">Variant:</label>
      <select id="yp-editor-variant-select" class="text_pole" style="width: 100%;"></select>
    </div>
    <div style="margin-bottom: 10px;">
      <label for="yp-editor-textarea" style="display: block; margin-bottom: 5px;">Content:</label>
      <textarea id="yp-editor-textarea" class="text_pole"
        style="width: 100%; min-height: 300px; font-family: monospace;"></textarea>
    </div>
    <div style="display: flex; gap: 10px; justify-content: flex-end;">
      <button id="yp-editor-save" class="menu_button primary">
        <i class="fa-solid fa-floppy-disk"></i> Save
      </button>
      <button id="yp-editor-cancel" class="menu_button secondary">
        <i class="fa-solid fa-xmark"></i> Cancel
      </button>
    </div>
  </div>
</div>